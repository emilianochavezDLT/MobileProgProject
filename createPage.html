<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Create Page</title>
    <link rel="stylesheet" href="mainPageSheet.css">
    <script src="mainPageJS.js"></script>
</head>

<body>
        <!-- The navigation bar -->
        <ul>
            <li><a class="active" href="mainPage.html">Home</a></li>
            <!--Once the user clicks on "My Playlists" the side bar will open-->
            <li><a onclick="openVisibilty('sideBar')">My Playslists</a></li>
            <li><a href="createPage.html">Create</a></li>
            <li><a href="landingPage.html">Explore</a></li>
        </ul>

        <!-- The side bar will be hidden until the user clicks on "My Playlists"-->
        <div id="sideBar" class="sideBarClass" style="display: none">
            <!--Close button that is an x-->
            <a href="javascript:void(0)" class="xbutton" onclick="closeVisibilty('sideBar')">x</a>
            
            
            <!-- The side bar will have a title-->
            <h3 style="font-size: 20; color: aliceblue; text-align: center;" >Playlists</h3>

            <!-- The side bar will have a list of playlists-->
            <div id="parentList">

            </div>

        
        </div>
        <script>
            //Here we are going to use fetch to get the data from the server
            //We will use the fetch api to make a get request to the server
            //We will then use the data to populate the side bar
            fetch('/workouts')
            .then(res => res.json())

            //The data will be an array of objects
            //Each object will have a title and description

            .then(data => {
                //We are going to loop through the array of objects
                //We will create a list element for each object
                //We will then append the list element to the parent list
                data.forEach(workout => {
                    //Then we are going to function called displayPlaylist
                    //This function will take in a playlist object
                    //It will then create a list element and append it to the parent list
                    console.log(workout);
                    displayPlaylist(workout);
                });
            })
            .catch(err => console.log(err));

            //This function will take in a playlist object
            //It will then create a list element and append it to the parent list
            function displayPlaylist(playlist) {
                //Create a list element
                const listElement = document.createElement('li');
                //Create a link element
                const linkElement = document.createElement('a');
                //Set the href attribute of the link element
                linkElement.setAttribute('href', '/workouts/' + playlist._id);
                //Set the inner text of the link element
                linkElement.innerText = playlist.playlistTitle;
                //Append the link element to the list element
                listElement.appendChild(linkElement);
                //Append the list element to the parent list
                document.getElementById('parentList').appendChild(listElement);
            }
            

        </script>
        
        

    <!-- The beginning of our form-->
    <h1 id="create" style="text-align: center"> Workout Builder</h1>


    <!-- Manual Workout Playist Building -->
    <!-- Users creating a playist with a picture, name and short description-->

    <!-- Button to open create a playist. We can change this later. -->
    <div style="margin: auto;text-align: center;">
        <button class="greenBtn" onclick="openVisibilty('createPlaylist')" style="width:25%; text-align:center"> Create A Playlist </button>
    </div>


    <div class="formWrapper">
        <div class="formPopup" id="createPlaylist" style="display: none">

            <!--This will be a placeholder for a circular image that will right of the form
            so that the user will have an option to upload an image-->
            <div class="imgcontainer">
                <img src="" alt="Insert Image" class="playlistImage" >
            </div>

            <!-- This form will essntially pop up once the user clicks a big button "Create Playists"-->
            <form id="playlistForm" onsubmit="createList('playistTitle', 'Description', 'parentList', 'sideBar')">
                
                <!--Playlist Inputs-->
                <label><b>Name of Playlist</b></label>
                <br />
                <input type="text" placeholder="Playlist Name" name="Playlist" id="playistTitle"/>
                <br />
                <!-- The text area is an Html element that allows the user input any type of text-->
                <label><b>Description</b></label>
                <br />
                <textarea id="Description" placeholder=" Enter your workout here:" class="descriptionBox"></textarea>
                <br />
                <!--Buttons to submit or cancel the form-->
                <button type="submit" class="greenBtn">Create Playlist</button>
                <button type="button" class="cancelBtn" onclick="closeVisibilty('createPlaylist')">Cancel</button>

            </form>
             
            <script>
                //We are going be using fetch to send the data to the server
                //This function will be called when the user clicks the submit button
                //It will make a post request to the server   
                
                const form = document.getElementById('playlistForm');
                
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = JSON.stringify({
                        playlistTitle: document.getElementById('playistTitle').value,
                        description: document.getElementById('Description').value
                    });

                    console.log(formData);

                    fetch('/workouts', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: formData
                    })
                    .then(res => res.json())
                    .then(data => console.log(data))
                    .catch(err => console.log(err));

                    form.reset();
                
                });

            </script>

        </div>
    </div>
    <!--Ending of form-->


</body>
</html>